<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>before-after-hook | PWA Workshop</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="manifest" href="manifest.json">
    <meta name="description" content="Introduction to Progressive Web Applications">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="application-name" content="PWA Workshop Docs">
    <meta name="apple-mobile-web-app-title" content="PWA Workshop Docs">
    
    <link rel="preload" href="/assets/css/0.styles.c9269685.css" as="style"><link rel="preload" href="/assets/js/app.1ff487e6.js" as="script"><link rel="preload" href="/assets/js/2.19469b2b.js" as="script"><link rel="preload" href="/assets/js/1.6f1ef934.js" as="script"><link rel="preload" href="/assets/js/60.ae5ff8a9.js" as="script"><link rel="prefetch" href="/assets/js/10.9ceccfbf.js"><link rel="prefetch" href="/assets/js/11.7c904f5e.js"><link rel="prefetch" href="/assets/js/12.939c0d55.js"><link rel="prefetch" href="/assets/js/13.9e7546d3.js"><link rel="prefetch" href="/assets/js/14.1c1dda77.js"><link rel="prefetch" href="/assets/js/15.c2b36012.js"><link rel="prefetch" href="/assets/js/16.a86399ea.js"><link rel="prefetch" href="/assets/js/17.9aa1c5d4.js"><link rel="prefetch" href="/assets/js/18.76b938b8.js"><link rel="prefetch" href="/assets/js/19.2e6b2533.js"><link rel="prefetch" href="/assets/js/20.82849728.js"><link rel="prefetch" href="/assets/js/21.c61d69ee.js"><link rel="prefetch" href="/assets/js/22.35b66f3d.js"><link rel="prefetch" href="/assets/js/23.4035d5be.js"><link rel="prefetch" href="/assets/js/24.c66fd85a.js"><link rel="prefetch" href="/assets/js/25.da49a6e2.js"><link rel="prefetch" href="/assets/js/26.ae78996d.js"><link rel="prefetch" href="/assets/js/27.b4b8b8a1.js"><link rel="prefetch" href="/assets/js/28.81f7352d.js"><link rel="prefetch" href="/assets/js/29.9e8716fb.js"><link rel="prefetch" href="/assets/js/3.3efec36e.js"><link rel="prefetch" href="/assets/js/30.33b8e1d1.js"><link rel="prefetch" href="/assets/js/31.cc75035b.js"><link rel="prefetch" href="/assets/js/32.90a77f18.js"><link rel="prefetch" href="/assets/js/33.44cf70fc.js"><link rel="prefetch" href="/assets/js/34.f672da4a.js"><link rel="prefetch" href="/assets/js/35.7d66fc77.js"><link rel="prefetch" href="/assets/js/36.9bc65e11.js"><link rel="prefetch" href="/assets/js/37.e404a38f.js"><link rel="prefetch" href="/assets/js/38.5b3881e8.js"><link rel="prefetch" href="/assets/js/39.df61cee3.js"><link rel="prefetch" href="/assets/js/4.c01b16e6.js"><link rel="prefetch" href="/assets/js/40.7f516925.js"><link rel="prefetch" href="/assets/js/41.976fcaad.js"><link rel="prefetch" href="/assets/js/42.9569119e.js"><link rel="prefetch" href="/assets/js/43.5eb6d74c.js"><link rel="prefetch" href="/assets/js/44.e7d635f3.js"><link rel="prefetch" href="/assets/js/45.50204063.js"><link rel="prefetch" href="/assets/js/46.06ea0baf.js"><link rel="prefetch" href="/assets/js/47.0d61679f.js"><link rel="prefetch" href="/assets/js/48.ba2fc676.js"><link rel="prefetch" href="/assets/js/49.ceab4c78.js"><link rel="prefetch" href="/assets/js/5.85fe764d.js"><link rel="prefetch" href="/assets/js/50.65eed350.js"><link rel="prefetch" href="/assets/js/51.d622cc82.js"><link rel="prefetch" href="/assets/js/52.b3c359b5.js"><link rel="prefetch" href="/assets/js/53.8263a1d3.js"><link rel="prefetch" href="/assets/js/54.a26e999d.js"><link rel="prefetch" href="/assets/js/55.82c04c1a.js"><link rel="prefetch" href="/assets/js/56.82f9414c.js"><link rel="prefetch" href="/assets/js/57.87972581.js"><link rel="prefetch" href="/assets/js/58.19f96269.js"><link rel="prefetch" href="/assets/js/59.19563258.js"><link rel="prefetch" href="/assets/js/6.268c3966.js"><link rel="prefetch" href="/assets/js/61.54dfee7a.js"><link rel="prefetch" href="/assets/js/62.22d302cb.js"><link rel="prefetch" href="/assets/js/63.398e68fe.js"><link rel="prefetch" href="/assets/js/64.1431b97b.js"><link rel="prefetch" href="/assets/js/65.4908a545.js"><link rel="prefetch" href="/assets/js/66.55927046.js"><link rel="prefetch" href="/assets/js/67.062d51d3.js"><link rel="prefetch" href="/assets/js/68.aade6588.js"><link rel="prefetch" href="/assets/js/69.18d07a09.js"><link rel="prefetch" href="/assets/js/7.35092d36.js"><link rel="prefetch" href="/assets/js/70.68ca6251.js"><link rel="prefetch" href="/assets/js/71.c85f89d8.js"><link rel="prefetch" href="/assets/js/72.82655067.js"><link rel="prefetch" href="/assets/js/73.eede0435.js"><link rel="prefetch" href="/assets/js/74.157cc7aa.js"><link rel="prefetch" href="/assets/js/75.73b66951.js"><link rel="prefetch" href="/assets/js/76.6649bb64.js"><link rel="prefetch" href="/assets/js/77.0fed6726.js"><link rel="prefetch" href="/assets/js/78.29aaa828.js"><link rel="prefetch" href="/assets/js/79.94afd192.js"><link rel="prefetch" href="/assets/js/80.ca638a89.js"><link rel="prefetch" href="/assets/js/81.333ba269.js"><link rel="prefetch" href="/assets/js/82.27169079.js"><link rel="prefetch" href="/assets/js/83.c97456b4.js"><link rel="prefetch" href="/assets/js/84.4a8863b4.js"><link rel="prefetch" href="/assets/js/85.5e1bf0b7.js"><link rel="prefetch" href="/assets/js/86.62118f50.js"><link rel="prefetch" href="/assets/js/87.530b3ac6.js"><link rel="prefetch" href="/assets/js/88.23419234.js"><link rel="prefetch" href="/assets/js/89.86ba6c86.js"><link rel="prefetch" href="/assets/js/90.29dcdad2.js"><link rel="prefetch" href="/assets/js/91.05020850.js"><link rel="prefetch" href="/assets/js/92.d82b22b2.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.f9004e39.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c9269685.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">PWA Workshop</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://pwa-cookbook.js.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Cookbook
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/sylvainpolletvillard/pwa-workshop" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Language</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Language</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/app/node_modules/before-after-hook/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/fr/" class="nav-link">
  Fran√ßais
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://pwa-cookbook.js.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Cookbook
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/sylvainpolletvillard/pwa-workshop" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Language</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Language</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/app/node_modules/before-after-hook/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/fr/" class="nav-link">
  Fran√ßais
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">Introduction</a></li><li><a href="/1-manifest/" class="sidebar-link">1. Adding a Web App Manifest</a></li><li><a href="/2-service-worker/" class="sidebar-link">2. Install a Service Worker</a></li><li><a href="/3-precaching/" class="sidebar-link">3. Precaching and basic offline mode</a></li><li><a href="/4-api-cache/" class="sidebar-link">4. Cache Strategy for REST API</a></li><li><a href="/5-pwa-install/" class="sidebar-link">5. Install PWA on the device</a></li><li><a href="/6-background-sync/" class="sidebar-link">6. Background sync and notifications</a></li><li><a href="/finish.html" class="sidebar-link">To go further</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="before-after-hook"><a href="#before-after-hook" class="header-anchor">#</a> before-after-hook</h1> <blockquote><p>asynchronous hooks for internal functionality</p></blockquote> <p><a href="https://www.npmjs.com/package/before-after-hook" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/npm/dw/before-after-hook.svg" alt="npm downloads"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="https://github.com/gr2m/before-after-hook/actions/workflows/test.yml" target="_blank" rel="noopener noreferrer"><img src="https://github.com/gr2m/before-after-hook/actions/workflows/test.yml/badge.svg" alt="Test"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="usage"><a href="#usage" class="header-anchor">#</a> Usage</h2> <h3 id="singular-hook"><a href="#singular-hook" class="header-anchor">#</a> Singular hook</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// instantiate singular hook API</span>
<span class="token keyword">const</span> hook <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Hook<span class="token punctuation">.</span>Singular</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create a hook</span>
<span class="token keyword">function</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">hook</span><span class="token punctuation">(</span>fetchFromDatabase<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>handleData<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>handleGetError<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// register before/error/after hooks.</span>
<span class="token comment">// The methods can be async or return a promise</span>
hook<span class="token punctuation">.</span><span class="token function">before</span><span class="token punctuation">(</span>beforeHook<span class="token punctuation">)</span><span class="token punctuation">;</span>
hook<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>errorHook<span class="token punctuation">)</span><span class="token punctuation">;</span>
hook<span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span>afterHook<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">123</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="hook-collection"><a href="#hook-collection" class="header-anchor">#</a> Hook collection</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// instantiate hook collection API</span>
<span class="token keyword">const</span> hookCollection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Hook<span class="token punctuation">.</span>Collection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create a hook</span>
<span class="token keyword">function</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">hookCollection</span><span class="token punctuation">(</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> fetchFromDatabase<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>handleData<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>handleGetError<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// register before/error/after hooks.</span>
<span class="token comment">// The methods can be async or return a promise</span>
hookCollection<span class="token punctuation">.</span><span class="token function">before</span><span class="token punctuation">(</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> beforeHook<span class="token punctuation">)</span><span class="token punctuation">;</span>
hookCollection<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> errorHook<span class="token punctuation">)</span><span class="token punctuation">;</span>
hookCollection<span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> afterHook<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">123</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="hook-singular-vs-hook-collection"><a href="#hook-singular-vs-hook-collection" class="header-anchor">#</a> Hook.Singular vs Hook.Collection</h3> <p>There's no fundamental difference between the <code>Hook.Singular</code> and <code>Hook.Collection</code> hooks except for the fact that a hook from a collection requires you to pass along the name. Therefore the following explanation applies to both code snippets as described above.</p> <p>The methods are executed in the following order</p> <ol><li><code>beforeHook</code></li> <li><code>fetchFromDatabase</code></li> <li><code>afterHook</code></li> <li><code>handleData</code></li></ol> <p><code>beforeHook</code> can mutate <code>options</code> before it‚Äôs passed to <code>fetchFromDatabase</code>.</p> <p>If an error is thrown in <code>beforeHook</code> or <code>fetchFromDatabase</code> then <code>errorHook</code> is
called next.</p> <p>If <code>afterHook</code> throws an error then <code>handleGetError</code> is called instead
of <code>handleData</code>.</p> <p>If <code>errorHook</code> throws an error then <code>handleGetError</code> is called next, otherwise
<code>afterHook</code> and <code>handleData</code>.</p> <p>You can also use <code>hook.wrap</code> to achieve the same thing as shown above (collection example):</p> <div class="language-js extra-class"><pre class="language-js"><code>hookCollection<span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">getData<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> <span class="token function">beforeHook</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">getData</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">errorHook</span><span class="token punctuation">(</span>error<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">await</span> <span class="token function">afterHook</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="install"><a href="#install" class="header-anchor">#</a> Install</h2> <div class="language- extra-class"><pre class="language-text"><code>npm install before-after-hook
</code></pre></div><p>Or download <a href="https://github.com/gr2m/before-after-hook/releases/latest" target="_blank" rel="noopener noreferrer">the latest <code>before-after-hook.min.js</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h2 id="api"><a href="#api" class="header-anchor">#</a> API</h2> <ul><li><a href="#singular-hook-api">Singular Hook Constructor</a></li> <li><a href="#hook-collection-api">Hook Collection Constructor</a></li></ul> <h2 id="singular-hook-api"><a href="#singular-hook-api" class="header-anchor">#</a> Singular hook API</h2> <ul><li><a href="#singular-constructor">Singular constructor</a></li> <li><a href="#singular-api">hook.api</a></li> <li><a href="#singular-api">hook()</a></li> <li><a href="#singular-api">hook.before()</a></li> <li><a href="#singular-api">hook.error()</a></li> <li><a href="#singular-api">hook.after()</a></li> <li><a href="#singular-api">hook.wrap()</a></li> <li><a href="#singular-api">hook.remove()</a></li></ul> <h3 id="singular-constructor"><a href="#singular-constructor" class="header-anchor">#</a> Singular constructor</h3> <p>The <code>Hook.Singular</code> constructor has no options and returns a <code>hook</code> instance with the
methods below:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> hook <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Hook<span class="token punctuation">.</span>Singular</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Using the singular hook is recommended for <a href="#typescript">TypeScript</a></p> <h3 id="singular-api"><a href="#singular-api" class="header-anchor">#</a> Singular API</h3> <p>The singular hook is a reference to a single hook. This means that there's no need to pass along any identifier (such as a <code>name</code> as can be seen in the <a href="#hookcollectionapi">Hook.Collection API</a>).</p> <p>The API of a singular hook is exactly the same as a collection hook and we therefore suggest you read the <a href="#hookcollectionapi">Hook.Collection API</a> and leave out any use of the <code>name</code> argument. Just skip it like described in this example:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> hook <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Hook<span class="token punctuation">.</span>Singular</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// good</span>
hook<span class="token punctuation">.</span><span class="token function">before</span><span class="token punctuation">(</span>beforeHook<span class="token punctuation">)</span><span class="token punctuation">;</span>
hook<span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span>afterHook<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">hook</span><span class="token punctuation">(</span>fetchFromDatabase<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// bad</span>
hook<span class="token punctuation">.</span><span class="token function">before</span><span class="token punctuation">(</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> beforeHook<span class="token punctuation">)</span><span class="token punctuation">;</span>
hook<span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> afterHook<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">hook</span><span class="token punctuation">(</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> fetchFromDatabase<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="hook-collection-api"><a href="#hook-collection-api" class="header-anchor">#</a> Hook collection API</h2> <ul><li><a href="#collection-constructor">Collection constructor</a></li> <li><a href="#hookcollectionapi">hookCollection.api</a></li> <li><a href="#hookcollection">hookCollection()</a></li> <li><a href="#hookcollectionbefore">hookCollection.before()</a></li> <li><a href="#hookcollectionerror">hookCollection.error()</a></li> <li><a href="#hookcollectionafter">hookCollection.after()</a></li> <li><a href="#hookcollectionwrap">hookCollection.wrap()</a></li> <li><a href="#hookcollectionremove">hookCollection.remove()</a></li></ul> <h3 id="collection-constructor"><a href="#collection-constructor" class="header-anchor">#</a> Collection constructor</h3> <p>The <code>Hook.Collection</code> constructor has no options and returns a <code>hookCollection</code> instance with the
methods below</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> hookCollection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Hook<span class="token punctuation">.</span>Collection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="hookcollection-api"><a href="#hookcollection-api" class="header-anchor">#</a> hookCollection.api</h3> <p>Use the <code>api</code> property to return the public API:</p> <ul><li><a href="#hookcollectionbefore">hookCollection.before()</a></li> <li><a href="#hookcollectionafter">hookCollection.after()</a></li> <li><a href="#hookcollectionerror">hookCollection.error()</a></li> <li><a href="#hookcollectionwrap">hookCollection.wrap()</a></li> <li><a href="#hookcollectionremove">hookCollection.remove()</a></li></ul> <p>That way you don‚Äôt need to expose the <a href="#hookcollection">hookCollection()</a> method to consumers of your library</p> <h3 id="hookcollection"><a href="#hookcollection" class="header-anchor">#</a> hookCollection()</h3> <p>Invoke before and after hooks. Returns a promise.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">hookCollection</span><span class="token punctuation">(</span>nameOrNames<span class="token punctuation">,</span> method <span class="token comment">/*, options */</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><table><thead><tr><th>Argument</th> <th>Type</th> <th>Description</th> <th>Required</th></tr></thead> <tr><th align="left"><code>name</code></th> <td>String or Array of Strings</td> <td>Hook name, for example <code>'save'</code>. Or an array of names, see example below.</td> <td>Yes</td></tr> <tr><th align="left"><code>method</code></th> <td>Function</td> <td>Callback to be executed after all before hooks finished execution successfully. <code>options</code> is passed as first argument</td> <td>Yes</td></tr> <tr><th align="left"><code>options</code></th> <td>Object</td> <td>Will be passed to all before hooks as reference, so they can mutate it</td> <td>No, defaults to empty object (<code>{}</code>)</td></tr></table> <p>Resolves with whatever <code>method</code> returns or resolves with.
Rejects with error that is thrown or rejected with by</p> <ol><li>Any of the before hooks, whichever rejects / throws first</li> <li><code>method</code></li> <li>Any of the after hooks, whichever rejects / throws first</li></ol> <p>Simple Example</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">hookCollection</span><span class="token punctuation">(</span>
  <span class="token string">&quot;save&quot;</span><span class="token punctuation">,</span>
  <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">record</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> store<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  record
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// shorter:  hookCollection('save', store.save, record)</span>

hookCollection<span class="token punctuation">.</span><span class="token function">before</span><span class="token punctuation">(</span><span class="token string">&quot;save&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">addTimestamps</span><span class="token punctuation">(</span><span class="token parameter">record</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> now <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toISOString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>record<span class="token punctuation">.</span>createdAt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    record<span class="token punctuation">.</span>updatedAt <span class="token operator">=</span> now<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    record<span class="token punctuation">.</span>createdAt <span class="token operator">=</span> now<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Example defining multiple hooks at once.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">hookCollection</span><span class="token punctuation">(</span>
  <span class="token punctuation">[</span><span class="token string">&quot;add&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;save&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">record</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> store<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  record
<span class="token punctuation">)</span><span class="token punctuation">;</span>

hookCollection<span class="token punctuation">.</span><span class="token function">before</span><span class="token punctuation">(</span><span class="token string">&quot;add&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">addTimestamps</span><span class="token punctuation">(</span><span class="token parameter">record</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>record<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;type property is required&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

hookCollection<span class="token punctuation">.</span><span class="token function">before</span><span class="token punctuation">(</span><span class="token string">&quot;save&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">addTimestamps</span><span class="token punctuation">(</span><span class="token parameter">record</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>record<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;type property is required&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Defining multiple hooks is helpful if you have similar methods for which you want to define separate hooks, but also an additional hook that gets called for all at once. The example above is equal to this:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">hookCollection</span><span class="token punctuation">(</span>
  <span class="token string">&quot;add&quot;</span><span class="token punctuation">,</span>
  <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">record</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">hookCollection</span><span class="token punctuation">(</span>
      <span class="token string">&quot;save&quot;</span><span class="token punctuation">,</span>
      <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">record</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> store<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      record
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  record
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="hookcollection-before"><a href="#hookcollection-before" class="header-anchor">#</a> hookCollection.before()</h3> <p>Add before hook for given name.</p> <div class="language-js extra-class"><pre class="language-js"><code>hookCollection<span class="token punctuation">.</span><span class="token function">before</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> method<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><table><thead><tr><th>Argument</th> <th>Type</th> <th>Description</th> <th>Required</th></tr></thead> <tr><th align="left"><code>name</code></th> <td>String</td> <td>Hook name, for example <code>'save'</code></td> <td>Yes</td></tr> <tr><th align="left"><code>method</code></th> <td>Function</td> <td>
      Executed before the wrapped method. Called with the hook‚Äôs
      <code>options</code> argument. Before hooks can mutate the passed options
      before they are passed to the wrapped method.
    </td> <td>Yes</td></tr></table> <p>Example</p> <div class="language-js extra-class"><pre class="language-js"><code>hookCollection<span class="token punctuation">.</span><span class="token function">before</span><span class="token punctuation">(</span><span class="token string">&quot;save&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">validate</span><span class="token punctuation">(</span><span class="token parameter">record</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>record<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;name property is required&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="hookcollection-error"><a href="#hookcollection-error" class="header-anchor">#</a> hookCollection.error()</h3> <p>Add error hook for given name.</p> <div class="language-js extra-class"><pre class="language-js"><code>hookCollection<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> method<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><table><thead><tr><th>Argument</th> <th>Type</th> <th>Description</th> <th>Required</th></tr></thead> <tr><th align="left"><code>name</code></th> <td>String</td> <td>Hook name, for example <code>'save'</code></td> <td>Yes</td></tr> <tr><th align="left"><code>method</code></th> <td>Function</td> <td>
      Executed when an error occurred in either the wrapped method or a
      <code>before</code> hook. Called with the thrown <code>error</code>
      and the hook‚Äôs <code>options</code> argument. The first <code>method</code>
      which does not throw an error will set the result that the after hook
      methods will receive.
    </td> <td>Yes</td></tr></table> <p>Example</p> <div class="language-js extra-class"><pre class="language-js"><code>hookCollection<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;save&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span>ignore<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token keyword">throw</span> error<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="hookcollection-after"><a href="#hookcollection-after" class="header-anchor">#</a> hookCollection.after()</h3> <p>Add after hook for given name.</p> <div class="language-js extra-class"><pre class="language-js"><code>hookCollection<span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> method<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><table><thead><tr><th>Argument</th> <th>Type</th> <th>Description</th> <th>Required</th></tr></thead> <tr><th align="left"><code>name</code></th> <td>String</td> <td>Hook name, for example <code>'save'</code></td> <td>Yes</td></tr> <tr><th align="left"><code>method</code></th> <td>Function</td> <td>
    Executed after wrapped method. Called with what the wrapped method
    resolves with the hook‚Äôs <code>options</code> argument.
    </td> <td>Yes</td></tr></table> <p>Example</p> <div class="language-js extra-class"><pre class="language-js"><code>hookCollection<span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span><span class="token string">&quot;save&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">result<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>updatedAt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    app<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&quot;update&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    app<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&quot;create&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="hookcollection-wrap"><a href="#hookcollection-wrap" class="header-anchor">#</a> hookCollection.wrap()</h3> <p>Add wrap hook for given name.</p> <div class="language-js extra-class"><pre class="language-js"><code>hookCollection<span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> method<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><table><thead><tr><th>Argument</th> <th>Type</th> <th>Description</th> <th>Required</th></tr></thead> <tr><th align="left"><code>name</code></th> <td>String</td> <td>Hook name, for example <code>'save'</code></td> <td>Yes</td></tr> <tr><th align="left"><code>method</code></th> <td>Function</td> <td>
      Receives both the wrapped method and the passed options as arguments so it can add logic before and after the wrapped method, it can handle errors and even replace the wrapped method altogether
    </td> <td>Yes</td></tr></table> <p>Example</p> <div class="language-js extra-class"><pre class="language-js"><code>hookCollection<span class="token punctuation">.</span><span class="token function">wrap</span><span class="token punctuation">(</span><span class="token string">&quot;save&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">saveInDatabase<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>record<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;name property is required&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">saveInDatabase</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>updatedAt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      app<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&quot;update&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      app<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&quot;create&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">.</span>ignore<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token keyword">throw</span> error<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>See also: <a href="/app/node_modules/before-after-hook/examples/test-mock-example.html">Test mock example</a></p> <h3 id="hookcollection-remove"><a href="#hookcollection-remove" class="header-anchor">#</a> hookCollection.remove()</h3> <p>Removes hook for given name.</p> <div class="language-js extra-class"><pre class="language-js"><code>hookCollection<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> hookMethod<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><table><thead><tr><th>Argument</th> <th>Type</th> <th>Description</th> <th>Required</th></tr></thead> <tr><th align="left"><code>name</code></th> <td>String</td> <td>Hook name, for example <code>'save'</code></td> <td>Yes</td></tr> <tr><th align="left"><code>beforeHookMethod</code></th> <td>Function</td> <td>
      Same function that was previously passed to <code>hookCollection.before()</code>, <code>hookCollection.error()</code>, <code>hookCollection.after()</code> or <code>hookCollection.wrap()</code></td> <td>Yes</td></tr></table> <p>Example</p> <div class="language-js extra-class"><pre class="language-js"><code>hookCollection<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">&quot;save&quot;</span><span class="token punctuation">,</span> validateRecord<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="typescript"><a href="#typescript" class="header-anchor">#</a> TypeScript</h2> <p>This library contains type definitions for TypeScript.</p> <h3 id="type-support-for-singular"><a href="#type-support-for-singular" class="header-anchor">#</a> Type support for <code>Singular</code>:</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Hook <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;before-after-hook&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">TOptions</span> <span class="token operator">=</span> <span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// type for options</span>
<span class="token keyword">type</span> <span class="token class-name">TResult</span> <span class="token operator">=</span> <span class="token punctuation">{</span> bar<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// type for result</span>
<span class="token keyword">type</span> <span class="token class-name">TError</span> <span class="token operator">=</span> Error<span class="token punctuation">;</span> <span class="token comment">// type for error</span>

<span class="token keyword">const</span> hook <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Hook</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">Singular</span><span class="token generic class-name"><span class="token operator">&lt;</span>TOptions<span class="token punctuation">,</span> TResult<span class="token punctuation">,</span> TError<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

hook<span class="token punctuation">.</span><span class="token function">before</span><span class="token punctuation">(</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// `options.foo` has `string` type</span>

  <span class="token comment">// not allowed</span>
  options<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>

  <span class="token comment">// allowed</span>
  options<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">&quot;Forty-Two&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> hookedMethod <span class="token operator">=</span> <span class="token function">hook</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// `options.foo` has `string` type</span>

    <span class="token comment">// not allowed, because it does not satisfy the `R` type</span>
    <span class="token class-name"><span class="token keyword">return</span></span> <span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token number">42</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// allowed</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> bar<span class="token operator">:</span> <span class="token number">42</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> foo<span class="token operator">:</span> <span class="token string">&quot;Forty-Two&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can choose not to pass the types for options, result or error. So, these are completely valid:</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> hook <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Hook</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">Singular</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">O</span><span class="token punctuation">,</span> <span class="token constant">R</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> hook <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Hook</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">Singular</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">O</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> hook <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Hook</span><span class="token punctuation">.</span><span class="token function">Singular</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>In these cases, the omitted types will implicitly be <code>any</code>.</p> <h3 id="type-support-for-collection"><a href="#type-support-for-collection" class="header-anchor">#</a> Type support for <code>Collection</code>:</h3> <p><code>Collection</code> also has strict type support. You can use it like this:</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Hook <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;before-after-hook&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">HooksType</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  add<span class="token operator">:</span> <span class="token punctuation">{</span>
    Options<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    Result<span class="token operator">:</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    Error<span class="token operator">:</span> Error<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  save<span class="token operator">:</span> <span class="token punctuation">{</span>
    Options<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    Result<span class="token operator">:</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  read<span class="token operator">:</span> <span class="token punctuation">{</span>
    Options<span class="token operator">:</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span> foo<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  destroy<span class="token operator">:</span> <span class="token punctuation">{</span>
    Options<span class="token operator">:</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span> foo<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> hooks <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Hook</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">Collection</span><span class="token generic class-name"><span class="token operator">&lt;</span>HooksType<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

hooks<span class="token punctuation">.</span><span class="token function">before</span><span class="token punctuation">(</span><span class="token string">&quot;destroy&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// `options.id` has `number` type</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

hooks<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;add&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// `options.type` has `string` type</span>
  <span class="token comment">// `err` is `instanceof Error`</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

hooks<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;save&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// `options.type` has `string` type</span>
  <span class="token comment">// `err` has type `any`</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

hooks<span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span><span class="token string">&quot;save&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>result<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// `options.type` has `string` type</span>
  <span class="token comment">// `result.id` has `number` type</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can choose not to pass the types altogether. In that case, everything will implicitly be <code>any</code>:</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> hook <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Hook</span><span class="token punctuation">.</span><span class="token function">Collection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Alternative imports:</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Singular<span class="token punctuation">,</span> Collection <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;before-after-hook&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> hook <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singular</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> hooks <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Collection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="upgrading-to-1-4"><a href="#upgrading-to-1-4" class="header-anchor">#</a> Upgrading to 1.4</h2> <p>Since version 1.4 the <code>Hook</code> constructor has been deprecated in favor of returning <code>Hook.Singular</code> in an upcoming breaking release.</p> <p>Version 1.4 is still 100% backwards-compatible, but if you want to continue using hook collections, we recommend using the <code>Hook.Collection</code> constructor instead before the next release.</p> <p>For even more details, check out <a href="https://github.com/gr2m/before-after-hook/pull/52" target="_blank" rel="noopener noreferrer">the PR<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h2 id="see-also"><a href="#see-also" class="header-anchor">#</a> See also</h2> <p>If <code>before-after-hook</code> is not for you, have a look at one of these alternatives:</p> <ul><li>https://github.com/keystonejs/grappling-hook</li> <li>https://github.com/sebelga/promised-hooks</li> <li>https://github.com/bnoguchi/hooks-js</li> <li>https://github.com/cb1kenobi/hook-emitter</li></ul> <h2 id="license"><a href="#license" class="header-anchor">#</a> License</h2> <p><a href="LICENSE">Apache 2.0</a></p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.1ff487e6.js" defer></script><script src="/assets/js/2.19469b2b.js" defer></script><script src="/assets/js/1.6f1ef934.js" defer></script><script src="/assets/js/60.ae5ff8a9.js" defer></script>
  </body>
</html>
